# デバッグ履歴サマリー

## 1. 主要なデバッグ経緯と解決策

### 1.1. `param()` ブロック解析エラー

* **問題:** `param()` ブロックの配置ミスによる解析エラー。
* **解決策:** `param()` ブロックをスクリプトの最先頭に配置。
* **教訓:** PowerShellの構文規則の重要性。

### 1.2. 時刻解析エラー

* **問題:** `[datetime]::Parse()` で時刻が正しく解析されない。
* **解決策:** `[datetime]::ParseExact()` と `HH:mm` フォーマットを使用。
* **教訓:** 日付/時刻解析には `ParseExact` と正確なフォーマット指定が必須。

### 1.3. 警告メッセージキャプチャ問題

* **問題:** `EmptyCsv` テストで警告が正しくキャプチャされない。
* **解決策:** `Invoke-Command` で `*>&1` を使用し、`@($variable).Length` で配列キャスト。
* **教訓:** ストリーム処理と型安全な操作の重要性。

### 1.4. デバッグログのプロパティ参照エラー

* **問題:** `$CsvEncoding.EncodingName` 等へのアクセスでエラー。
* **解決策:** `$CsvEncoding.WebName` または `$($CsvEncoding.ToString())` を使用。
* **教訓:** オブジェクトのプロパティアクセスは安全に行う。

### 1.5. `CsvEncoding` `パラメータ`型変換エラー

* **問題:** 文字列のエンコーディング名を `System.Text.Encoding` オブジェクトに変換せずに渡していた。
* **解決策:** `[System.Text.Encoding]::GetEncoding()` で変換。
* **教訓:** `パラメータ`の型を厳密に合わせる。

### 1.6. 日付解析正規表現の不備

* **問題:** 年が省略された日付形式 (`MM/DD`) が正規表現で解析されない。
* **解決策:** 正規表現を `'((?:\d{1,4}/)?\d{1,2}/\d{1,2})(?:.*)?\s*(\d{2}:\d{2})(?:.*)?'` に修正。
* **教訓:** 複雑なロジックは単体テストで検証する。

### 1.7. 繰り返し発生したデバッグ失敗

* **問題:** `replace` ツールの厳密なマッチング、PowerShellの複雑な挙動、デバッグプロセスの非効率性。
* **解決策:** `read_file` で最新内容確認、最小単位での変更、単体テストの徹底、段階的な修正と検証、安全なデバッグログの使用。
* **教訓:** デバッグプロセスの改善と知識の蓄積。

## 2. 今後の開発における注意点

* **ドキュメントの更新:** 新しい機能追加や仕様変更があった場合は、関連するドキュメントを速やかに更新する。
* **テストの追加:** 新機能や修正には、必ず対応するテストケースを追加し、既存のテストスイートを維持・強化する。
* **ファイル管理:** 一時ファイルや不要なファイルは、削除せずに `archive/` ディレクトリに日付をつけて移動するルールを遵守する。
* **WSL 環境での文字化け:** PowerShellの出力における文字化けは、表示上の問題として認識し、スクリプトの機能に影響しない限り、許容する。ただし、デバッグログの出力方法には注意を払う。
